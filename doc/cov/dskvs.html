
<html>
    <head>
        <title>Coverage Report</title>
        
        <style type="text/css">
            body { background-color: #fff; }
            table {
                margin-left: 10px;
                border-collapse: collapse;
            }
            td { 
                background-color: #fff; 
                padding: 2px;
            }
            table.overview td {
                padding-right: 20px;
            }
            td.percent, td.linecount { text-align: right; }
            div.package, #totalcov { 
                position: fixed;
                color: #fff;
                background-color: #375eab; 
                font-size: 16px;
                font-weight: bold;
                padding: 10px;
                border-radius: 5px 5px 5px 5px;
            }
            div.package, #totalcov { 
                float: right; 
                right: 10px;
            }
            #totalcov { 
                background-color: #fff;
                color: #000;
                border: 1px solid #375eab;
                clear: both;
            }
            div.package {
                top: 10px;
            }
            #doctitle { 
                background-color: #fff; 
                font-size: 24px;
                margin-top: 20px;
                margin-left: 10px;
                color: #375eab;
                font-weight: bold;
            }
            #about {
                margin-left: 18px;
                font-size: 10px;
            }
            table tr:last-child td {
                font-weight: bold;
            }
            .functitle, .funcname { 
                text-align: center; 
                font-size: 20px; 
                font-weight: bold; 
                color: 375eab; 
            }
            .funcname {
                text-align: left;
                margin-top: 20px;
                margin-left: 10px;
                margin-bottom: 20px;
                padding: 2px 5px 5px;
                background-color: #e0ebf5;
            }
            table.listing {
                margin-left: 10px;
            }
            table.listing td {
                padding: 0px;
                font-size: 12px;
                background-color: #eee; 
                vertical-align: top;
                padding-left: 10px;
                border-bottom: 1px solid #fff;
            }
            table.listing td:first-child {
                text-align: right;
                font-weight: bold;
                vertical-align: center;
            }
            table.listing tr.miss td {
                background-color: #FFBBB8;
            }
            table.listing tr:last-child td {
                font-weight: normal;
                color: #000;
            }
            table.listing tr:last-child td:first-child {
                font-weight: bold;
            }
            .info {
                margin-left: 10px;
            }
            .info code {
            }
            pre { margin: 1px; }
            pre.cmd { 
                background-color: #e9e9e9;
                border-radius: 5px 5px 5px 5px;
                padding: 10px;
                margin: 20px;
                line-height: 18px;
                font-size; 14px;
            }
            a { 
                text-decoration: none; 
                color: #375eab;
            }
            a:hover { text-decoration: underline; }
            p { margin-left: 10px; }
        </style>
        
    </head>
    <body>
        <div id="doctitle">Coverage Report</div>
    <div id="about">Generated on 01 Jul 13 02:18 -0400 with <a href="https://github.com/matm/gocov-html">gocov-html</a></div><div class="package">github.com/aybabtme/dskvs</div>
<div id="totalcov">github.com/aybabtme/dskvs</div>
<div class="funcname">Overview</div><p>This is a coverage report created after analysis of the <code>github.com/aybabtme/dskvs</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/aybabtme/dskvs | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_collections.put"><td><code><a href="#fn_collections.put">collections.put(...)</a></code></td><td><code>github.com/aybabtme/dskvs/collection.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>14/14</code></td></tr>
<tr id="s_fn_member.getMembers"><td><code><a href="#fn_member.getMembers">member.getMembers(...)</a></code></td><td><code>github.com/aybabtme/dskvs/member.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>12/12</code></td></tr>
<tr id="s_fn_member.put"><td><code><a href="#fn_member.put">member.put(...)</a></code></td><td><code>github.com/aybabtme/dskvs/member.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>11/11</code></td></tr>
<tr id="s_fn_generateFilename"><td><code><a href="#fn_generateFilename">generateFilename(...)</a></code></td><td><code>github.com/aybabtme/dskvs/files.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>9/9</code></td></tr>
<tr id="s_fn_page.delete"><td><code><a href="#fn_page.delete">page.delete(...)</a></code></td><td><code>github.com/aybabtme/dskvs/page.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>8/8</code></td></tr>
<tr id="s_fn_member.delete"><td><code><a href="#fn_member.delete">member.delete(...)</a></code></td><td><code>github.com/aybabtme/dskvs/member.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>8/8</code></td></tr>
<tr id="s_fn_janitor.run"><td><code><a href="#fn_janitor.run">janitor.run(...)</a></code></td><td><code>github.com/aybabtme/dskvs/janitor.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>8/8</code></td></tr>
<tr id="s_fn_page.set"><td><code><a href="#fn_page.set">page.set(...)</a></code></td><td><code>github.com/aybabtme/dskvs/page.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>7/7</code></td></tr>
<tr id="s_fn_member.get"><td><code><a href="#fn_member.get">member.get(...)</a></code></td><td><code>github.com/aybabtme/dskvs/member.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>6/6</code></td></tr>
<tr id="s_fn_collections.get"><td><code><a href="#fn_collections.get">collections.get(...)</a></code></td><td><code>github.com/aybabtme/dskvs/collection.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>6/6</code></td></tr>
<tr id="s_fn_janitor.unloadStore"><td><code><a href="#fn_janitor.unloadStore">janitor.unloadStore(...)</a></code></td><td><code>github.com/aybabtme/dskvs/janitor.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>5/5</code></td></tr>
<tr id="s_fn_member.deleteAll"><td><code><a href="#fn_member.deleteAll">member.deleteAll(...)</a></code></td><td><code>github.com/aybabtme/dskvs/member.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>4/4</code></td></tr>
<tr id="s_fn_init"><td><code><a href="#fn_init">init(...)</a></code></td><td><code>github.com/aybabtme/dskvs/dskvs.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>2/2</code></td></tr>
<tr id="s_fn_janitor.die"><td><code><a href="#fn_janitor.die">janitor.die(...)</a></code></td><td><code>github.com/aybabtme/dskvs/janitor.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>2/2</code></td></tr>
<tr id="s_fn_errorNoSuchKey"><td><code><a href="#fn_errorNoSuchKey">errorNoSuchKey(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_errorNoSuchColl"><td><code><a href="#fn_errorNoSuchColl">errorNoSuchColl(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_newPage"><td><code><a href="#fn_newPage">newPage(...)</a></code></td><td><code>github.com/aybabtme/dskvs/page.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_newJanitor"><td><code><a href="#fn_newJanitor">newJanitor(...)</a></code></td><td><code>github.com/aybabtme/dskvs/janitor.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_newMember"><td><code><a href="#fn_newMember">newMember(...)</a></code></td><td><code>github.com/aybabtme/dskvs/member.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_newCollections"><td><code><a href="#fn_newCollections">newCollections(...)</a></code></td><td><code>github.com/aybabtme/dskvs/collection.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_fromPageToBytes"><td><code><a href="#fn_fromPageToBytes">fromPageToBytes(...)</a></code></td><td><code>github.com/aybabtme/dskvs/files.go</code></td><td class="percent"><code>92.31%</code></td><td class="linecount"><code>12/13</code></td></tr>
<tr id="s_fn_collections.deleteCollection"><td><code><a href="#fn_collections.deleteCollection">collections.deleteCollection(...)</a></code></td><td><code>github.com/aybabtme/dskvs/collection.go</code></td><td class="percent"><code>85.71%</code></td><td class="linecount"><code>12/14</code></td></tr>
<tr id="s_fn_Store.Load"><td><code><a href="#fn_Store.Load">Store.Load(...)</a></code></td><td><code>github.com/aybabtme/dskvs/dskvs.go</code></td><td class="percent"><code>85.71%</code></td><td class="linecount"><code>12/14</code></td></tr>
<tr id="s_fn_collections.deleteKey"><td><code><a href="#fn_collections.deleteKey">collections.deleteKey(...)</a></code></td><td><code>github.com/aybabtme/dskvs/collection.go</code></td><td class="percent"><code>85.71%</code></td><td class="linecount"><code>6/7</code></td></tr>
<tr id="s_fn_collections.getCollection"><td><code><a href="#fn_collections.getCollection">collections.getCollection(...)</a></code></td><td><code>github.com/aybabtme/dskvs/collection.go</code></td><td class="percent"><code>83.33%</code></td><td class="linecount"><code>5/6</code></td></tr>
<tr id="s_fn_writeToFile"><td><code><a href="#fn_writeToFile">writeToFile(...)</a></code></td><td><code>github.com/aybabtme/dskvs/files.go</code></td><td class="percent"><code>81.82%</code></td><td class="linecount"><code>18/22</code></td></tr>
<tr id="s_fn_isCollectionKey"><td><code><a href="#fn_isCollectionKey">isCollectionKey(...)</a></code></td><td><code>github.com/aybabtme/dskvs/helpers.go</code></td><td class="percent"><code>80.00%</code></td><td class="linecount"><code>4/5</code></td></tr>
<tr id="s_fn_page.get"><td><code><a href="#fn_page.get">page.get(...)</a></code></td><td><code>github.com/aybabtme/dskvs/page.go</code></td><td class="percent"><code>80.00%</code></td><td class="linecount"><code>4/5</code></td></tr>
<tr id="s_fn_janitor.loadStore"><td><code><a href="#fn_janitor.loadStore">janitor.loadStore(...)</a></code></td><td><code>github.com/aybabtme/dskvs/janitor.go</code></td><td class="percent"><code>79.49%</code></td><td class="linecount"><code>31/39</code></td></tr>
<tr id="s_fn_NewStore"><td><code><a href="#fn_NewStore">NewStore(...)</a></code></td><td><code>github.com/aybabtme/dskvs/dskvs.go</code></td><td class="percent"><code>75.00%</code></td><td class="linecount"><code>3/4</code></td></tr>
<tr id="s_fn_deleteFile"><td><code><a href="#fn_deleteFile">deleteFile(...)</a></code></td><td><code>github.com/aybabtme/dskvs/files.go</code></td><td class="percent"><code>75.00%</code></td><td class="linecount"><code>3/4</code></td></tr>
<tr id="s_fn_splitKeys"><td><code><a href="#fn_splitKeys">splitKeys(...)</a></code></td><td><code>github.com/aybabtme/dskvs/helpers.go</code></td><td class="percent"><code>75.00%</code></td><td class="linecount"><code>3/4</code></td></tr>
<tr id="s_fn_expandPath"><td><code><a href="#fn_expandPath">expandPath(...)</a></code></td><td><code>github.com/aybabtme/dskvs/helpers.go</code></td><td class="percent"><code>75.00%</code></td><td class="linecount"><code>3/4</code></td></tr>
<tr id="s_fn_Store.Close"><td><code><a href="#fn_Store.Close">Store.Close(...)</a></code></td><td><code>github.com/aybabtme/dskvs/dskvs.go</code></td><td class="percent"><code>72.73%</code></td><td class="linecount"><code>8/11</code></td></tr>
<tr id="s_fn_janitor.shouldDie"><td><code><a href="#fn_janitor.shouldDie">janitor.shouldDie(...)</a></code></td><td><code>github.com/aybabtme/dskvs/janitor.go</code></td><td class="percent"><code>71.43%</code></td><td class="linecount"><code>5/7</code></td></tr>
<tr id="s_fn_headerFromBytes"><td><code><a href="#fn_headerFromBytes">headerFromBytes(...)</a></code></td><td><code>github.com/aybabtme/dskvs/files.go</code></td><td class="percent"><code>71.43%</code></td><td class="linecount"><code>5/7</code></td></tr>
<tr id="s_fn_readFromFile"><td><code><a href="#fn_readFromFile">readFromFile(...)</a></code></td><td><code>github.com/aybabtme/dskvs/files.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>14/21</code></td></tr>
<tr id="s_fn_newFileHeader"><td><code><a href="#fn_newFileHeader">newFileHeader(...)</a></code></td><td><code>github.com/aybabtme/dskvs/files.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>4/6</code></td></tr>
<tr id="s_fn_headerToBytes"><td><code><a href="#fn_headerToBytes">headerToBytes(...)</a></code></td><td><code>github.com/aybabtme/dskvs/files.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>4/6</code></td></tr>
<tr id="s_fn_createFolder"><td><code><a href="#fn_createFolder">createFolder(...)</a></code></td><td><code>github.com/aybabtme/dskvs/files.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>2/3</code></td></tr>
<tr id="s_fn_deleteFolder"><td><code><a href="#fn_deleteFolder">deleteFolder(...)</a></code></td><td><code>github.com/aybabtme/dskvs/files.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>2/3</code></td></tr>
<tr id="s_fn_isValidPath"><td><code><a href="#fn_isValidPath">isValidPath(...)</a></code></td><td><code>github.com/aybabtme/dskvs/helpers.go</code></td><td class="percent"><code>63.64%</code></td><td class="linecount"><code>7/11</code></td></tr>
<tr id="s_fn_Store.Delete"><td><code><a href="#fn_Store.Delete">Store.Delete(...)</a></code></td><td><code>github.com/aybabtme/dskvs/dskvs.go</code></td><td class="percent"><code>60.00%</code></td><td class="linecount"><code>6/10</code></td></tr>
<tr id="s_fn_Store.Get"><td><code><a href="#fn_Store.Get">Store.Get(...)</a></code></td><td><code>github.com/aybabtme/dskvs/dskvs.go</code></td><td class="percent"><code>60.00%</code></td><td class="linecount"><code>6/10</code></td></tr>
<tr id="s_fn_Store.Put"><td><code><a href="#fn_Store.Put">Store.Put(...)</a></code></td><td><code>github.com/aybabtme/dskvs/dskvs.go</code></td><td class="percent"><code>60.00%</code></td><td class="linecount"><code>6/10</code></td></tr>
<tr id="s_fn_checkKeyValid"><td><code><a href="#fn_checkKeyValid">checkKeyValid(...)</a></code></td><td><code>github.com/aybabtme/dskvs/helpers.go</code></td><td class="percent"><code>60.00%</code></td><td class="linecount"><code>3/5</code></td></tr>
<tr id="s_fn_janitor.dirtyPageIfNoMember"><td><code><a href="#fn_janitor.dirtyPageIfNoMember">janitor.dirtyPageIfNoMember(...)</a></code></td><td><code>github.com/aybabtme/dskvs/janitor.go</code></td><td class="percent"><code>60.00%</code></td><td class="linecount"><code>3/5</code></td></tr>
<tr id="s_fn_Store.GetAll"><td><code><a href="#fn_Store.GetAll">Store.GetAll(...)</a></code></td><td><code>github.com/aybabtme/dskvs/dskvs.go</code></td><td class="percent"><code>57.14%</code></td><td class="linecount"><code>4/7</code></td></tr>
<tr id="s_fn_Store.DeleteAll"><td><code><a href="#fn_Store.DeleteAll">Store.DeleteAll(...)</a></code></td><td><code>github.com/aybabtme/dskvs/dskvs.go</code></td><td class="percent"><code>57.14%</code></td><td class="linecount"><code>4/7</code></td></tr>
<tr id="s_fn_KeyError.Error"><td><code><a href="#fn_KeyError.Error">KeyError.Error(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_errorGetAllIsNotColl"><td><code><a href="#fn_errorGetAllIsNotColl">errorGetAllIsNotColl(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_errorGetIsColl"><td><code><a href="#fn_errorGetIsColl">errorGetIsColl(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_errorEmptyKey"><td><code><a href="#fn_errorEmptyKey">errorEmptyKey(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_errorNoKey"><td><code><a href="#fn_errorNoKey">errorNoKey(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_errorNoColl"><td><code><a href="#fn_errorNoColl">errorNoColl(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_errorPathInvalid"><td><code><a href="#fn_errorPathInvalid">errorPathInvalid(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_errorPathInUse"><td><code><a href="#fn_errorPathInUse">errorPathInUse(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_PathError.Error"><td><code><a href="#fn_PathError.Error">PathError.Error(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_errorStoreNotLoaded"><td><code><a href="#fn_errorStoreNotLoaded">errorStoreNotLoaded(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_StoreError.Error"><td><code><a href="#fn_StoreError.Error">StoreError.Error(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_errorDeleteAllIsNotColl"><td><code><a href="#fn_errorDeleteAllIsNotColl">errorDeleteAllIsNotColl(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_errorDeleteIsColl"><td><code><a href="#fn_errorDeleteIsColl">errorDeleteIsColl(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_errorPutIsColl"><td><code><a href="#fn_errorPutIsColl">errorPutIsColl(...)</a></code></td><td><code>github.com/aybabtme/dskvs/errors.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr><td colspan="2"><code>github.com/aybabtme/dskvs</code></td><td class="percent"><code>78.32%</code></td><td class="linecount"><code>307/392</code></td></tr>
</table>

<div class="funcname" id="fn_collections.put">func collections.put</div><div class="info"><a href="#s_fn_collections.put">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/collection.go</code>:</p></div><table class="listing">
<tr><td>44</td><td><code><pre>func (c *collections) put(coll, key string, value []byte) error {</pre></code></td></tr><tr><td>45</td><td><code><pre>        c.RLock()</pre></code></td></tr><tr><td>46</td><td><code><pre>        m, ok := c.members[coll]</pre></code></td></tr><tr><td>47</td><td><code><pre>        c.RUnlock()</pre></code></td></tr><tr><td>48</td><td><code><pre></pre></code></td></tr><tr><td>49</td><td><code><pre>        if !ok {</pre></code></td></tr><tr><td>50</td><td><code><pre></pre></code></td></tr><tr><td>51</td><td><code><pre>                // Another goroutine could have created the entry since our read</pre></code></td></tr><tr><td>52</td><td><code><pre>                // of ok, so need to Lock and verify again that it's still not</pre></code></td></tr><tr><td>53</td><td><code><pre>                // an entry.  Not doing so would drop the member that was `put`</pre></code></td></tr><tr><td>54</td><td><code><pre>                // by the other goroutine</pre></code></td></tr><tr><td>55</td><td><code><pre>                c.Lock()</pre></code></td></tr><tr><td>56</td><td><code><pre>                _, stillOk := c.members[coll]</pre></code></td></tr><tr><td>57</td><td><code><pre>                if !stillOk {</pre></code></td></tr><tr><td>58</td><td><code><pre>                        log.Printf("Creating new collection <%s>", coll)</pre></code></td></tr><tr><td>59</td><td><code><pre>                        m = newMember(c.basepath, coll)</pre></code></td></tr><tr><td>60</td><td><code><pre>                        c.members[coll] = m</pre></code></td></tr><tr><td>61</td><td><code><pre>                        jan.ToCreate <- m</pre></code></td></tr><tr><td>62</td><td><code><pre>                }</pre></code></td></tr><tr><td>63</td><td><code><pre>                c.Unlock()</pre></code></td></tr><tr><td>64</td><td><code><pre>        }</pre></code></td></tr><tr><td>65</td><td><code><pre></pre></code></td></tr><tr><td>66</td><td><code><pre>        m.put(key, value)</pre></code></td></tr><tr><td>67</td><td><code><pre></pre></code></td></tr><tr><td>68</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>69</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_member.getMembers">func member.getMembers</div><div class="info"><a href="#s_fn_member.getMembers">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/member.go</code>:</p></div><table class="listing">
<tr><td>36</td><td><code><pre>func (m *member) getMembers() [][]byte {</pre></code></td></tr><tr><td>37</td><td><code><pre>        // This is tricky because we don't want to lock the whole map for</pre></code></td></tr><tr><td>38</td><td><code><pre>        // reading while doing this query.  We don't want that for two reasons:</pre></code></td></tr><tr><td>39</td><td><code><pre>        // 1. If there are many ongoing writes on the pages, chances are we will</pre></code></td></tr><tr><td>40</td><td><code><pre>        //          not be able to proceed with our read-lock.</pre></code></td></tr><tr><td>41</td><td><code><pre>        // 2. If there are writes following our read, they will have to wait</pre></code></td></tr><tr><td>42</td><td><code><pre>        //    for the duration of our procedure.</pre></code></td></tr><tr><td>43</td><td><code><pre>        // However, we still want consistent results. The solution follows:</pre></code></td></tr><tr><td>44</td><td><code><pre></pre></code></td></tr><tr><td>45</td><td><code><pre>        // Lock the map for read</pre></code></td></tr><tr><td>46</td><td><code><pre>        m.RLock()</pre></code></td></tr><tr><td>47</td><td><code><pre>        var pages []*page</pre></code></td></tr><tr><td>48</td><td><code><pre>        // Get a snapshot of the pages</pre></code></td></tr><tr><td>49</td><td><code><pre>        for _, aPage := range m.entries {</pre></code></td></tr><tr><td>50</td><td><code><pre>                pages = append(pages, aPage)</pre></code></td></tr><tr><td>51</td><td><code><pre>        }</pre></code></td></tr><tr><td>52</td><td><code><pre>        // Release the lock, everybody is free to use the map again</pre></code></td></tr><tr><td>53</td><td><code><pre>        m.RUnlock()</pre></code></td></tr><tr><td>54</td><td><code><pre></pre></code></td></tr><tr><td>55</td><td><code><pre>        // Now we want to grab the bytes in the pages</pre></code></td></tr><tr><td>56</td><td><code><pre>        var values [][]byte</pre></code></td></tr><tr><td>57</td><td><code><pre>        var aVal []byte</pre></code></td></tr><tr><td>58</td><td><code><pre>        for _, aPage := range pages {</pre></code></td></tr><tr><td>59</td><td><code><pre>                // As we iterate over every page, other goroutines can do so as well.</pre></code></td></tr><tr><td>60</td><td><code><pre>                // Since the map is not locked, page[i+1] could be deleted while we</pre></code></td></tr><tr><td>61</td><td><code><pre>                // read page[i]. In such a case, when we get to read page[i+1], we'll</pre></code></td></tr><tr><td>62</td><td><code><pre>                // want to discard this value.</pre></code></td></tr><tr><td>63</td><td><code><pre>                aVal = aPage.get()</pre></code></td></tr><tr><td>64</td><td><code><pre>                // If the page has been deleted, page.get() contracts says it will</pre></code></td></tr><tr><td>65</td><td><code><pre>                // return a nil-slice</pre></code></td></tr><tr><td>66</td><td><code><pre>                if aVal == nil {</pre></code></td></tr><tr><td>67</td><td><code><pre>                        // So we can discard those deleted bytes</pre></code></td></tr><tr><td>68</td><td><code><pre>                } else {</pre></code></td></tr><tr><td>69</td><td><code><pre>                        // And keep only those that are still valid</pre></code></td></tr><tr><td>70</td><td><code><pre>                        values = append(values, aVal)</pre></code></td></tr><tr><td>71</td><td><code><pre>                }</pre></code></td></tr><tr><td>72</td><td><code><pre>        }</pre></code></td></tr><tr><td>73</td><td><code><pre>        // That's all folks!</pre></code></td></tr><tr><td>74</td><td><code><pre>        return values</pre></code></td></tr><tr><td>75</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_member.put">func member.put</div><div class="info"><a href="#s_fn_member.put">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/member.go</code>:</p></div><table class="listing">
<tr><td>77</td><td><code><pre>func (m *member) put(key string, value []byte) {</pre></code></td></tr><tr><td>78</td><td><code><pre></pre></code></td></tr><tr><td>79</td><td><code><pre>        // We'd rather not write-lock the whole map if we don't need to</pre></code></td></tr><tr><td>80</td><td><code><pre>        m.RLock()</pre></code></td></tr><tr><td>81</td><td><code><pre>        aPage, ok := m.entries[key]</pre></code></td></tr><tr><td>82</td><td><code><pre>        m.RUnlock()</pre></code></td></tr><tr><td>83</td><td><code><pre></pre></code></td></tr><tr><td>84</td><td><code><pre>        // But if the entry doesn't exist, we need to write one</pre></code></td></tr><tr><td>85</td><td><code><pre>        if !ok {</pre></code></td></tr><tr><td>86</td><td><code><pre>                m.Lock()</pre></code></td></tr><tr><td>87</td><td><code><pre>                // Before writing the entry, we verify that is was not added since</pre></code></td></tr><tr><td>88</td><td><code><pre>                // last read</pre></code></td></tr><tr><td>89</td><td><code><pre>                aPage, ok = m.entries[key]</pre></code></td></tr><tr><td>90</td><td><code><pre>                if !ok {</pre></code></td></tr><tr><td>91</td><td><code><pre>                        // It was not so go ahead and write a new entry</pre></code></td></tr><tr><td>92</td><td><code><pre>                        aPage = newPage(m.basepath, m.coll, key)</pre></code></td></tr><tr><td>93</td><td><code><pre>                        m.entries[key] = aPage</pre></code></td></tr><tr><td>94</td><td><code><pre>                }</pre></code></td></tr><tr><td>95</td><td><code><pre>                m.Unlock()</pre></code></td></tr><tr><td>96</td><td><code><pre>        }</pre></code></td></tr><tr><td>97</td><td><code><pre></pre></code></td></tr><tr><td>98</td><td><code><pre>        // Operate on the page itself, which holds a more granular lock</pre></code></td></tr><tr><td>99</td><td><code><pre>        aPage.set(value)</pre></code></td></tr><tr><td>100</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_generateFilename">func generateFilename</div><div class="info"><a href="#s_fn_generateFilename">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/files.go</code>:</p></div><table class="listing">
<tr><td>193</td><td><code><pre>func generateFilename(aPage *page) string {</pre></code></td></tr><tr><td>194</td><td><code><pre></pre></code></td></tr><tr><td>195</td><td><code><pre>        // url.QueryEscape incidentally escapes runes unsafe for a generateFilename</pre></code></td></tr><tr><td>196</td><td><code><pre>        escaped := url.QueryEscape(aPage.key)</pre></code></td></tr><tr><td>197</td><td><code><pre></pre></code></td></tr><tr><td>198</td><td><code><pre>        // Keep 40 first bytes for readability of generateFilename</pre></code></td></tr><tr><td>199</td><td><code><pre>        var max_length int</pre></code></td></tr><tr><td>200</td><td><code><pre>        if len(escaped) > 40 {</pre></code></td></tr><tr><td>201</td><td><code><pre>                max_length = 40</pre></code></td></tr><tr><td>202</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>203</td><td><code><pre>                max_length = len(escaped)</pre></code></td></tr><tr><td>204</td><td><code><pre>        }</pre></code></td></tr><tr><td>205</td><td><code><pre></pre></code></td></tr><tr><td>206</td><td><code><pre>        prefix := []byte(escaped)[:max_length]</pre></code></td></tr><tr><td>207</td><td><code><pre></pre></code></td></tr><tr><td>208</td><td><code><pre>        // Append checksum value to the end, avoids collisions</pre></code></td></tr><tr><td>209</td><td><code><pre>        hash := sha1.New().Sum([]byte(aPage.key))</pre></code></td></tr><tr><td>210</td><td><code><pre>        suffix := hex.EncodeToString(hash)</pre></code></td></tr><tr><td>211</td><td><code><pre></pre></code></td></tr><tr><td>212</td><td><code><pre>        return filepath.Join(aPage.basepath, aPage.coll, string(prefix)+suffix)</pre></code></td></tr><tr><td>213</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_page.delete">func page.delete</div><div class="info"><a href="#s_fn_page.delete">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/page.go</code>:</p></div><table class="listing">
<tr><td>48</td><td><code><pre>func (p *page) delete() {</pre></code></td></tr><tr><td>49</td><td><code><pre>        p.Lock()</pre></code></td></tr><tr><td>50</td><td><code><pre>        defer p.Unlock()</pre></code></td></tr><tr><td>51</td><td><code><pre>        wasDirty := p.isDirty</pre></code></td></tr><tr><td>52</td><td><code><pre>        p.value = nil</pre></code></td></tr><tr><td>53</td><td><code><pre>        p.isDirty = true</pre></code></td></tr><tr><td>54</td><td><code><pre>        p.isDeleted = true</pre></code></td></tr><tr><td>55</td><td><code><pre>        if !wasDirty {</pre></code></td></tr><tr><td>56</td><td><code><pre>                jan.DirtyPages <- p</pre></code></td></tr><tr><td>57</td><td><code><pre>        }</pre></code></td></tr><tr><td>58</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_member.delete">func member.delete</div><div class="info"><a href="#s_fn_member.delete">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/member.go</code>:</p></div><table class="listing">
<tr><td>102</td><td><code><pre>func (m *member) delete(key string) {</pre></code></td></tr><tr><td>103</td><td><code><pre>        // If the page is already deleted, we don't waste time</pre></code></td></tr><tr><td>104</td><td><code><pre>        m.RLock()</pre></code></td></tr><tr><td>105</td><td><code><pre>        aPage, ok := m.entries[key]</pre></code></td></tr><tr><td>106</td><td><code><pre>        m.RUnlock()</pre></code></td></tr><tr><td>107</td><td><code><pre></pre></code></td></tr><tr><td>108</td><td><code><pre>        if ok {</pre></code></td></tr><tr><td>109</td><td><code><pre>                // Delete the page from the entries first</pre></code></td></tr><tr><td>110</td><td><code><pre>                m.Lock()</pre></code></td></tr><tr><td>111</td><td><code><pre>                delete(m.entries, key)</pre></code></td></tr><tr><td>112</td><td><code><pre>                m.Unlock()</pre></code></td></tr><tr><td>113</td><td><code><pre>                // Then let the page delete itself on a more granular lock</pre></code></td></tr><tr><td>114</td><td><code><pre>                aPage.delete()</pre></code></td></tr><tr><td>115</td><td><code><pre>        }</pre></code></td></tr><tr><td>116</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_janitor.run">func janitor.run</div><div class="info"><a href="#s_fn_janitor.run">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/janitor.go</code>:</p></div><table class="listing">
<tr><td>121</td><td><code><pre>func (j *janitor) run() {</pre></code></td></tr><tr><td>122</td><td><code><pre>        go func() {</pre></code></td></tr><tr><td>123</td><td><code><pre>                for {</pre></code></td></tr><tr><td>124</td><td><code><pre>                        select {</pre></code></td></tr><tr><td>125</td><td><code><pre>                        case dirty := <-j.dirtyPageIfNoMember():</pre></code></td></tr><tr><td>126</td><td><code><pre>                                writeToFile(dirty)</pre></code></td></tr><tr><td>127</td><td><code><pre>                        case delete := <-j.ToDelete:</pre></code></td></tr><tr><td>128</td><td><code><pre>                                deleteFolder(delete)</pre></code></td></tr><tr><td>129</td><td><code><pre>                        case create := <-j.ToCreate:</pre></code></td></tr><tr><td>130</td><td><code><pre>                                createFolder(create)</pre></code></td></tr><tr><td>131</td><td><code><pre>                        case <-j.shouldDie():</pre></code></td></tr><tr><td>132</td><td><code><pre>                                j.blockUntilFinished <- false</pre></code></td></tr><tr><td>133</td><td><code><pre>                                return</pre></code></td></tr><tr><td>134</td><td><code><pre>                        }</pre></code></td></tr><tr><td>135</td><td><code><pre>                }</pre></code></td></tr><tr><td>136</td><td><code><pre>        }()</pre></code></td></tr><tr><td>137</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_page.set">func page.set</div><div class="info"><a href="#s_fn_page.set">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/page.go</code>:</p></div><table class="listing">
<tr><td>37</td><td><code><pre>func (p *page) set(value []byte) {</pre></code></td></tr><tr><td>38</td><td><code><pre>        p.Lock()</pre></code></td></tr><tr><td>39</td><td><code><pre>        defer p.Unlock()</pre></code></td></tr><tr><td>40</td><td><code><pre>        wasDirty := p.isDirty</pre></code></td></tr><tr><td>41</td><td><code><pre>        p.value = value</pre></code></td></tr><tr><td>42</td><td><code><pre>        p.isDirty = true</pre></code></td></tr><tr><td>43</td><td><code><pre>        if !wasDirty {</pre></code></td></tr><tr><td>44</td><td><code><pre>                jan.DirtyPages <- p</pre></code></td></tr><tr><td>45</td><td><code><pre>        }</pre></code></td></tr><tr><td>46</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_member.get">func member.get</div><div class="info"><a href="#s_fn_member.get">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/member.go</code>:</p></div><table class="listing">
<tr><td>24</td><td><code><pre>func (m *member) get(key string) ([]byte, error) {</pre></code></td></tr><tr><td>25</td><td><code><pre>        m.RLock()</pre></code></td></tr><tr><td>26</td><td><code><pre>        aPage, ok := m.entries[key]</pre></code></td></tr><tr><td>27</td><td><code><pre>        m.RUnlock()</pre></code></td></tr><tr><td>28</td><td><code><pre></pre></code></td></tr><tr><td>29</td><td><code><pre>        if !ok {</pre></code></td></tr><tr><td>30</td><td><code><pre>                return nil, errorNoSuchKey(key)</pre></code></td></tr><tr><td>31</td><td><code><pre>        }</pre></code></td></tr><tr><td>32</td><td><code><pre></pre></code></td></tr><tr><td>33</td><td><code><pre>        return aPage.get(), nil</pre></code></td></tr><tr><td>34</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_collections.get">func collections.get</div><div class="info"><a href="#s_fn_collections.get">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/collection.go</code>:</p></div><table class="listing">
<tr><td>21</td><td><code><pre>func (c *collections) get(coll, key string) ([]byte, error) {</pre></code></td></tr><tr><td>22</td><td><code><pre>        c.RLock()</pre></code></td></tr><tr><td>23</td><td><code><pre>        m, ok := c.members[coll]</pre></code></td></tr><tr><td>24</td><td><code><pre>        c.RUnlock()</pre></code></td></tr><tr><td>25</td><td><code><pre>        if !ok {</pre></code></td></tr><tr><td>26</td><td><code><pre>                return nil, errorNoSuchColl(coll)</pre></code></td></tr><tr><td>27</td><td><code><pre>        }</pre></code></td></tr><tr><td>28</td><td><code><pre></pre></code></td></tr><tr><td>29</td><td><code><pre>        return m.get(key)</pre></code></td></tr><tr><td>30</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_janitor.unloadStore">func janitor.unloadStore</div><div class="info"><a href="#s_fn_janitor.unloadStore">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/janitor.go</code>:</p></div><table class="listing">
<tr><td>86</td><td><code><pre>func (j *janitor) unloadStore(s *Store) error {</pre></code></td></tr><tr><td>87</td><td><code><pre></pre></code></td></tr><tr><td>88</td><td><code><pre>        j.die()</pre></code></td></tr><tr><td>89</td><td><code><pre>        log.Printf("Janitor blocking caller until done writing last changes")</pre></code></td></tr><tr><td>90</td><td><code><pre>        <-j.blockUntilFinished</pre></code></td></tr><tr><td>91</td><td><code><pre>        log.Printf("Janitor done writing last changes")</pre></code></td></tr><tr><td>92</td><td><code><pre></pre></code></td></tr><tr><td>93</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>94</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_member.deleteAll">func member.deleteAll</div><div class="info"><a href="#s_fn_member.deleteAll">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/member.go</code>:</p></div><table class="listing">
<tr><td>118</td><td><code><pre>func (m *member) deleteAll() {</pre></code></td></tr><tr><td>119</td><td><code><pre>        // In this case, it makes sense to just lock the whole map :</pre></code></td></tr><tr><td>120</td><td><code><pre>        // we're deleting everything...</pre></code></td></tr><tr><td>121</td><td><code><pre>        m.Lock()</pre></code></td></tr><tr><td>122</td><td><code><pre>        for _, aPage := range m.entries {</pre></code></td></tr><tr><td>123</td><td><code><pre>                aPage.delete()</pre></code></td></tr><tr><td>124</td><td><code><pre>        }</pre></code></td></tr><tr><td>125</td><td><code><pre>        m.Unlock()</pre></code></td></tr><tr><td>126</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_init">func init</div><div class="info"><a href="#s_fn_init">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/dskvs.go</code>:</p></div><table class="listing">
<tr><td>34</td><td><code><pre>func init() {</pre></code></td></tr><tr><td>35</td><td><code><pre>        storeExists = make(map[string]bool)</pre></code></td></tr><tr><td>36</td><td><code><pre>        jan = newJanitor()</pre></code></td></tr><tr><td>37</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_janitor.die">func janitor.die</div><div class="info"><a href="#s_fn_janitor.die">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/janitor.go</code>:</p></div><table class="listing">
<tr><td>139</td><td><code><pre>func (j *janitor) die() {</pre></code></td></tr><tr><td>140</td><td><code><pre>        log.Printf("Janitor will die")</pre></code></td></tr><tr><td>141</td><td><code><pre>        j.mustDie <- true</pre></code></td></tr><tr><td>142</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorNoSuchKey">func errorNoSuchKey</div><div class="info"><a href="#s_fn_errorNoSuchKey">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>93</td><td><code><pre>func errorNoSuchKey(key string) error {</pre></code></td></tr><tr><td>94</td><td><code><pre>        return KeyError{</pre></code></td></tr><tr><td>95</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>96</td><td><code><pre>                fmt.Sprintf("key<%s> has no value", key),</pre></code></td></tr><tr><td>97</td><td><code><pre>        }</pre></code></td></tr><tr><td>98</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorNoSuchColl">func errorNoSuchColl</div><div class="info"><a href="#s_fn_errorNoSuchColl">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>100</td><td><code><pre>func errorNoSuchColl(key string) error {</pre></code></td></tr><tr><td>101</td><td><code><pre>        return KeyError{</pre></code></td></tr><tr><td>102</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>103</td><td><code><pre>                fmt.Sprintf("key<%s> has no value", key),</pre></code></td></tr><tr><td>104</td><td><code><pre>        }</pre></code></td></tr><tr><td>105</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newPage">func newPage</div><div class="info"><a href="#s_fn_newPage">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/page.go</code>:</p></div><table class="listing">
<tr><td>17</td><td><code><pre>func newPage(basepath, coll, key string) *page {</pre></code></td></tr><tr><td>18</td><td><code><pre>        return &page{</pre></code></td></tr><tr><td>19</td><td><code><pre>                isDirty:   false,</pre></code></td></tr><tr><td>20</td><td><code><pre>                isDeleted: false,</pre></code></td></tr><tr><td>21</td><td><code><pre>                basepath:  basepath,</pre></code></td></tr><tr><td>22</td><td><code><pre>                coll:      coll,</pre></code></td></tr><tr><td>23</td><td><code><pre>                key:       key,</pre></code></td></tr><tr><td>24</td><td><code><pre>                value:     nil,</pre></code></td></tr><tr><td>25</td><td><code><pre>        }</pre></code></td></tr><tr><td>26</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newJanitor">func newJanitor</div><div class="info"><a href="#s_fn_newJanitor">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/janitor.go</code>:</p></div><table class="listing">
<tr><td>18</td><td><code><pre>func newJanitor() janitor {</pre></code></td></tr><tr><td>19</td><td><code><pre>        return janitor{</pre></code></td></tr><tr><td>20</td><td><code><pre>                make(chan *page),</pre></code></td></tr><tr><td>21</td><td><code><pre>                make(chan *member),</pre></code></td></tr><tr><td>22</td><td><code><pre>                make(chan *member),</pre></code></td></tr><tr><td>23</td><td><code><pre>                make(chan bool),</pre></code></td></tr><tr><td>24</td><td><code><pre>                make(chan bool),</pre></code></td></tr><tr><td>25</td><td><code><pre>        }</pre></code></td></tr><tr><td>26</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newMember">func newMember</div><div class="info"><a href="#s_fn_newMember">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/member.go</code>:</p></div><table class="listing">
<tr><td>16</td><td><code><pre>func newMember(basepath, coll string) *member {</pre></code></td></tr><tr><td>17</td><td><code><pre>        return &member{</pre></code></td></tr><tr><td>18</td><td><code><pre>                basepath: basepath,</pre></code></td></tr><tr><td>19</td><td><code><pre>                coll:     coll,</pre></code></td></tr><tr><td>20</td><td><code><pre>                entries:  make(map[string]*page),</pre></code></td></tr><tr><td>21</td><td><code><pre>        }</pre></code></td></tr><tr><td>22</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newCollections">func newCollections</div><div class="info"><a href="#s_fn_newCollections">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/collection.go</code>:</p></div><table class="listing">
<tr><td>14</td><td><code><pre>func newCollections(basepath string) *collections {</pre></code></td></tr><tr><td>15</td><td><code><pre>        return &collections{</pre></code></td></tr><tr><td>16</td><td><code><pre>                basepath: basepath,</pre></code></td></tr><tr><td>17</td><td><code><pre>                members:  make(map[string]*member),</pre></code></td></tr><tr><td>18</td><td><code><pre>        }</pre></code></td></tr><tr><td>19</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_fromPageToBytes">func fromPageToBytes</div><div class="info"><a href="#s_fn_fromPageToBytes">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/files.go</code>:</p></div><table class="listing">
<tr><td>215</td><td><code><pre>func fromPageToBytes(aPage *page) ([]byte, error) {</pre></code></td></tr><tr><td>216</td><td><code><pre>        keyBytes := []byte(aPage.key)</pre></code></td></tr><tr><td>217</td><td><code><pre></pre></code></td></tr><tr><td>218</td><td><code><pre>        header := newFileHeader(aPage)</pre></code></td></tr><tr><td>219</td><td><code><pre>        headerBytes, err := headerToBytes(header)</pre></code></td></tr><tr><td>220</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>221</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>222</td><td><code><pre>        }</pre></code></td></tr><tr><td>223</td><td><code><pre></pre></code></td></tr><tr><td>224</td><td><code><pre>        dataLength := len(headerBytes) + len(keyBytes) + len(aPage.value)</pre></code></td></tr><tr><td>225</td><td><code><pre>        keyIndex := len(headerBytes)</pre></code></td></tr><tr><td>226</td><td><code><pre>        payloadIndex := len(headerBytes) + len(keyBytes)</pre></code></td></tr><tr><td>227</td><td><code><pre></pre></code></td></tr><tr><td>228</td><td><code><pre>        data := make([]byte, dataLength)</pre></code></td></tr><tr><td>229</td><td><code><pre></pre></code></td></tr><tr><td>230</td><td><code><pre>        // Put the header</pre></code></td></tr><tr><td>231</td><td><code><pre>        copy(data, headerBytes)</pre></code></td></tr><tr><td>232</td><td><code><pre>        // Followed by the key name</pre></code></td></tr><tr><td>233</td><td><code><pre>        copy(data[keyIndex:], keyBytes)</pre></code></td></tr><tr><td>234</td><td><code><pre>        // Followed by the page value</pre></code></td></tr><tr><td>235</td><td><code><pre>        copy(data[payloadIndex:], aPage.value)</pre></code></td></tr><tr><td>236</td><td><code><pre></pre></code></td></tr><tr><td>237</td><td><code><pre>        return data, nil</pre></code></td></tr><tr><td>238</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_collections.deleteCollection">func collections.deleteCollection</div><div class="info"><a href="#s_fn_collections.deleteCollection">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/collection.go</code>:</p></div><table class="listing">
<tr><td>85</td><td><code><pre>func (c *collections) deleteCollection(coll string) error {</pre></code></td></tr><tr><td>86</td><td><code><pre>        c.RLock()</pre></code></td></tr><tr><td>87</td><td><code><pre>        _, ok := c.members[coll]</pre></code></td></tr><tr><td>88</td><td><code><pre>        c.RUnlock()</pre></code></td></tr><tr><td>89</td><td><code><pre></pre></code></td></tr><tr><td>90</td><td><code><pre>        if ok {</pre></code></td></tr><tr><td>91</td><td><code><pre>                c.Lock()</pre></code></td></tr><tr><td>92</td><td><code><pre>                m, ok := c.members[coll]</pre></code></td></tr><tr><td>93</td><td><code><pre>                delete(c.members, coll)</pre></code></td></tr><tr><td>94</td><td><code><pre>                c.Unlock()</pre></code></td></tr><tr><td>95</td><td><code><pre>                // Was deleted in between our read-lock and the current write-lock</pre></code></td></tr><tr><td>96</td><td><code><pre>                if !ok {</pre></code></td></tr><tr class="miss"><td>97</td><td><code><pre>                        return errorNoSuchColl(coll)</pre></code></td></tr><tr><td>98</td><td><code><pre>                }</pre></code></td></tr><tr><td>99</td><td><code><pre></pre></code></td></tr><tr><td>100</td><td><code><pre>                // TODO : This is not really necessary, can just delete the folder</pre></code></td></tr><tr><td>101</td><td><code><pre>                // at once and save some IO.</pre></code></td></tr><tr><td>102</td><td><code><pre>                m.deleteAll()</pre></code></td></tr><tr><td>103</td><td><code><pre>                jan.ToDelete <- m</pre></code></td></tr><tr><td>104</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>105</td><td><code><pre>                return errorNoSuchColl(coll)</pre></code></td></tr><tr><td>106</td><td><code><pre>        }</pre></code></td></tr><tr><td>107</td><td><code><pre></pre></code></td></tr><tr><td>108</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>109</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Store.Load">func Store.Load</div><div class="info"><a href="#s_fn_Store.Load">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/dskvs.go</code>:</p></div><table class="listing">
<tr><td>70</td><td><code><pre>func (s *Store) Load() error {</pre></code></td></tr><tr><td>71</td><td><code><pre>        storeExistsLock.RLock()</pre></code></td></tr><tr><td>72</td><td><code><pre>        exists := storeExists[s.storagePath]</pre></code></td></tr><tr><td>73</td><td><code><pre>        storeExistsLock.RUnlock()</pre></code></td></tr><tr><td>74</td><td><code><pre></pre></code></td></tr><tr><td>75</td><td><code><pre>        if exists {</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>                return errorPathInUse(s.storagePath)</pre></code></td></tr><tr><td>77</td><td><code><pre>        }</pre></code></td></tr><tr><td>78</td><td><code><pre></pre></code></td></tr><tr><td>79</td><td><code><pre>        storeExistsLock.Lock()</pre></code></td></tr><tr><td>80</td><td><code><pre>        storeExists[s.storagePath] = true</pre></code></td></tr><tr><td>81</td><td><code><pre>        storeExistsLock.Unlock()</pre></code></td></tr><tr><td>82</td><td><code><pre></pre></code></td></tr><tr><td>83</td><td><code><pre>        // TODO scan the path for files, load them in memory</pre></code></td></tr><tr><td>84</td><td><code><pre>        err := jan.loadStore(s)</pre></code></td></tr><tr><td>85</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>86</td><td><code><pre>                return err</pre></code></td></tr><tr><td>87</td><td><code><pre>        }</pre></code></td></tr><tr><td>88</td><td><code><pre>        jan.run()</pre></code></td></tr><tr><td>89</td><td><code><pre></pre></code></td></tr><tr><td>90</td><td><code><pre>        s.isLoaded = true</pre></code></td></tr><tr><td>91</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>92</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_collections.deleteKey">func collections.deleteKey</div><div class="info"><a href="#s_fn_collections.deleteKey">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/collection.go</code>:</p></div><table class="listing">
<tr><td>71</td><td><code><pre>func (c *collections) deleteKey(coll, key string) error {</pre></code></td></tr><tr><td>72</td><td><code><pre>        c.RLock()</pre></code></td></tr><tr><td>73</td><td><code><pre>        m, ok := c.members[coll]</pre></code></td></tr><tr><td>74</td><td><code><pre>        c.RUnlock()</pre></code></td></tr><tr><td>75</td><td><code><pre></pre></code></td></tr><tr><td>76</td><td><code><pre>        if !ok {</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>                return errorNoColl(coll)</pre></code></td></tr><tr><td>78</td><td><code><pre>        }</pre></code></td></tr><tr><td>79</td><td><code><pre></pre></code></td></tr><tr><td>80</td><td><code><pre>        m.delete(key)</pre></code></td></tr><tr><td>81</td><td><code><pre></pre></code></td></tr><tr><td>82</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>83</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_collections.getCollection">func collections.getCollection</div><div class="info"><a href="#s_fn_collections.getCollection">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/collection.go</code>:</p></div><table class="listing">
<tr><td>32</td><td><code><pre>func (c *collections) getCollection(coll string) ([][]byte, error) {</pre></code></td></tr><tr><td>33</td><td><code><pre>        c.RLock()</pre></code></td></tr><tr><td>34</td><td><code><pre>        m, ok := c.members[coll]</pre></code></td></tr><tr><td>35</td><td><code><pre>        c.RUnlock()</pre></code></td></tr><tr><td>36</td><td><code><pre></pre></code></td></tr><tr><td>37</td><td><code><pre>        if !ok {</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>                return nil, errorNoSuchColl(coll)</pre></code></td></tr><tr><td>39</td><td><code><pre>        }</pre></code></td></tr><tr><td>40</td><td><code><pre></pre></code></td></tr><tr><td>41</td><td><code><pre>        return m.getMembers(), nil</pre></code></td></tr><tr><td>42</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_writeToFile">func writeToFile</div><div class="info"><a href="#s_fn_writeToFile">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/files.go</code>:</p></div><table class="listing">
<tr><td>60</td><td><code><pre>func writeToFile(dirty *page) {</pre></code></td></tr><tr><td>61</td><td><code><pre>        // Don't need to lock the page before reading the key, it's only modified</pre></code></td></tr><tr><td>62</td><td><code><pre>        // when `page` are created</pre></code></td></tr><tr><td>63</td><td><code><pre>        filename := generateFilename(dirty)</pre></code></td></tr><tr><td>64</td><td><code><pre>        // Lock the page for read</pre></code></td></tr><tr><td>65</td><td><code><pre>        dirty.RLock()</pre></code></td></tr><tr><td>66</td><td><code><pre>        if dirty.isDeleted {</pre></code></td></tr><tr><td>67</td><td><code><pre>                dirty.RUnlock()</pre></code></td></tr><tr><td>68</td><td><code><pre>                deleteFile(filename)</pre></code></td></tr><tr><td>69</td><td><code><pre>                return</pre></code></td></tr><tr><td>70</td><td><code><pre>        }</pre></code></td></tr><tr><td>71</td><td><code><pre>        dirty.RUnlock()</pre></code></td></tr><tr><td>72</td><td><code><pre></pre></code></td></tr><tr><td>73</td><td><code><pre>        data, err := fromPageToBytes(dirty)</pre></code></td></tr><tr><td>74</td><td><code><pre></pre></code></td></tr><tr><td>75</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>                log.Printf("Couldn't get data from page: %v", err)</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>                return</pre></code></td></tr><tr><td>78</td><td><code><pre>        }</pre></code></td></tr><tr><td>79</td><td><code><pre></pre></code></td></tr><tr><td>80</td><td><code><pre>        dirty.Lock()</pre></code></td></tr><tr><td>81</td><td><code><pre>        if dirty.isDeleted {</pre></code></td></tr><tr><td>82</td><td><code><pre>                // Was requested for deletion right after we tested</pre></code></td></tr><tr><td>83</td><td><code><pre>                dirty.Unlock()</pre></code></td></tr><tr><td>84</td><td><code><pre>                writeToFile(dirty)</pre></code></td></tr><tr><td>85</td><td><code><pre>                return</pre></code></td></tr><tr><td>86</td><td><code><pre>        }</pre></code></td></tr><tr><td>87</td><td><code><pre>        dirty.isDirty = false</pre></code></td></tr><tr><td>88</td><td><code><pre>        dirty.Unlock()</pre></code></td></tr><tr><td>89</td><td><code><pre></pre></code></td></tr><tr><td>90</td><td><code><pre>        if err := ioutil.WriteFile(filename, data, FILE_PERM); err != nil {</pre></code></td></tr><tr class="miss"><td>91</td><td><code><pre>                log.Printf("Couldn't write file <%s> : %v", filename, err)</pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>                return</pre></code></td></tr><tr><td>93</td><td><code><pre>        }</pre></code></td></tr><tr><td>94</td><td><code><pre></pre></code></td></tr><tr><td>95</td><td><code><pre>        return</pre></code></td></tr><tr><td>96</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_isCollectionKey">func isCollectionKey</div><div class="info"><a href="#s_fn_isCollectionKey">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/helpers.go</code>:</p></div><table class="listing">
<tr><td>24</td><td><code><pre>func isCollectionKey(key string) bool {</pre></code></td></tr><tr><td>25</td><td><code><pre>        idxSeperator := strings.Index(key, CollKeySep)</pre></code></td></tr><tr><td>26</td><td><code><pre>        if idxSeperator < 0 {</pre></code></td></tr><tr><td>27</td><td><code><pre>                return true</pre></code></td></tr><tr><td>28</td><td><code><pre>        } else if idxSeperator == len(key)-1 {</pre></code></td></tr><tr class="miss"><td>29</td><td><code><pre>                return true</pre></code></td></tr><tr><td>30</td><td><code><pre>        }</pre></code></td></tr><tr><td>31</td><td><code><pre>        return false</pre></code></td></tr><tr><td>32</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_page.get">func page.get</div><div class="info"><a href="#s_fn_page.get">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/page.go</code>:</p></div><table class="listing">
<tr><td>28</td><td><code><pre>func (p *page) get() []byte {</pre></code></td></tr><tr><td>29</td><td><code><pre>        p.RLock()</pre></code></td></tr><tr><td>30</td><td><code><pre>        defer p.RUnlock()</pre></code></td></tr><tr><td>31</td><td><code><pre>        if p.isDeleted {</pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>33</td><td><code><pre>        }</pre></code></td></tr><tr><td>34</td><td><code><pre>        return p.value</pre></code></td></tr><tr><td>35</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_janitor.loadStore">func janitor.loadStore</div><div class="info"><a href="#s_fn_janitor.loadStore">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/janitor.go</code>:</p></div><table class="listing">
<tr><td>28</td><td><code><pre>func (j *janitor) loadStore(s *Store) error {</pre></code></td></tr><tr><td>29</td><td><code><pre></pre></code></td></tr><tr><td>30</td><td><code><pre>        log.Printf("Loading existing data")</pre></code></td></tr><tr><td>31</td><td><code><pre></pre></code></td></tr><tr><td>32</td><td><code><pre>        basepath := s.storagePath</pre></code></td></tr><tr><td>33</td><td><code><pre>        possibleColl, err := ioutil.ReadDir(basepath)</pre></code></td></tr><tr><td>34</td><td><code><pre>        if os.IsNotExist(err) {</pre></code></td></tr><tr><td>35</td><td><code><pre>                log.Printf("Store path is empty, starting with fresh persistence.")</pre></code></td></tr><tr><td>36</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>37</td><td><code><pre>        } else if err != nil {</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>                log.Printf("Can't list directory at path %s: %v", basepath, err)</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>                return err</pre></code></td></tr><tr><td>40</td><td><code><pre>        }</pre></code></td></tr><tr><td>41</td><td><code><pre></pre></code></td></tr><tr><td>42</td><td><code><pre>        log.Printf("... collection names")</pre></code></td></tr><tr><td>43</td><td><code><pre>        var memberPathList []string</pre></code></td></tr><tr><td>44</td><td><code><pre>        var memberPath string</pre></code></td></tr><tr><td>45</td><td><code><pre>        for _, file := range possibleColl {</pre></code></td></tr><tr><td>46</td><td><code><pre>                if file.IsDir() {</pre></code></td></tr><tr><td>47</td><td><code><pre>                        memberPath = filepath.Join(basepath, file.Name())</pre></code></td></tr><tr><td>48</td><td><code><pre>                        memberPathList = append(memberPathList, memberPath)</pre></code></td></tr><tr><td>49</td><td><code><pre>                        s.coll.members[file.Name()] = newMember(basepath, file.Name())</pre></code></td></tr><tr><td>50</td><td><code><pre>                        log.Printf("\t found <%s>", file.Name())</pre></code></td></tr><tr><td>51</td><td><code><pre>                }</pre></code></td></tr><tr><td>52</td><td><code><pre>        }</pre></code></td></tr><tr><td>53</td><td><code><pre></pre></code></td></tr><tr><td>54</td><td><code><pre>        log.Printf("... member names")</pre></code></td></tr><tr><td>55</td><td><code><pre>        var aPage *page</pre></code></td></tr><tr><td>56</td><td><code><pre>        var pagePath string</pre></code></td></tr><tr><td>57</td><td><code><pre>        for _, member := range memberPathList {</pre></code></td></tr><tr><td>58</td><td><code><pre>                log.Printf("... values for members of <%s>", filepath.Base(member))</pre></code></td></tr><tr><td>59</td><td><code><pre>                possiblePage, err := ioutil.ReadDir(member)</pre></code></td></tr><tr><td>60</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>61</td><td><code><pre>                        log.Printf("... skipping, can't list directory at path <%s>: %v",</pre></code></td></tr><tr><td>62</td><td><code><pre>                                basepath, err)</pre></code></td></tr><tr class="miss"><td>63</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>64</td><td><code><pre>                }</pre></code></td></tr><tr><td>65</td><td><code><pre></pre></code></td></tr><tr><td>66</td><td><code><pre>                for _, file := range possiblePage {</pre></code></td></tr><tr><td>67</td><td><code><pre>                        if !file.Mode().IsRegular() {</pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>                                log.Printf("... skipping irregular file <%s>", file.Name())</pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>70</td><td><code><pre>                        }</pre></code></td></tr><tr><td>71</td><td><code><pre>                        pagePath = filepath.Join(member, file.Name())</pre></code></td></tr><tr><td>72</td><td><code><pre>                        aPage, err = readFromFile(pagePath)</pre></code></td></tr><tr><td>73</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>74</td><td><code><pre>                                log.Printf("... skipping, error reading possible page file: %v",</pre></code></td></tr><tr><td>75</td><td><code><pre>                                        err)</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>77</td><td><code><pre>                        }</pre></code></td></tr><tr><td>78</td><td><code><pre>                        s.coll.members[aPage.coll].entries[aPage.key] = aPage</pre></code></td></tr><tr><td>79</td><td><code><pre>                        log.Printf("\t found <%s>", aPage.key)</pre></code></td></tr><tr><td>80</td><td><code><pre>                }</pre></code></td></tr><tr><td>81</td><td><code><pre>        }</pre></code></td></tr><tr><td>82</td><td><code><pre>        log.Printf("Done loading existing data")</pre></code></td></tr><tr><td>83</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>84</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewStore">func NewStore</div><div class="info"><a href="#s_fn_NewStore">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/dskvs.go</code>:</p></div><table class="listing">
<tr><td>55</td><td><code><pre>func NewStore(path string) (*Store, error) {</pre></code></td></tr><tr><td>56</td><td><code><pre></pre></code></td></tr><tr><td>57</td><td><code><pre>        if !isValidPath(path) {</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>                return nil, errorPathInvalid(path)</pre></code></td></tr><tr><td>59</td><td><code><pre>        }</pre></code></td></tr><tr><td>60</td><td><code><pre></pre></code></td></tr><tr><td>61</td><td><code><pre>        basepath := expandPath(path)</pre></code></td></tr><tr><td>62</td><td><code><pre>        return &Store{</pre></code></td></tr><tr><td>63</td><td><code><pre>                false,                    // isLoaded</pre></code></td></tr><tr><td>64</td><td><code><pre>                basepath,                 // storagePath</pre></code></td></tr><tr><td>65</td><td><code><pre>                newCollections(basepath), // collections</pre></code></td></tr><tr><td>66</td><td><code><pre>        }, nil</pre></code></td></tr><tr><td>67</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_deleteFile">func deleteFile</div><div class="info"><a href="#s_fn_deleteFile">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/files.go</code>:</p></div><table class="listing">
<tr><td>143</td><td><code><pre>func deleteFile(filename string) {</pre></code></td></tr><tr><td>144</td><td><code><pre>        err := os.Remove(filename)</pre></code></td></tr><tr><td>145</td><td><code><pre>        if os.IsNotExist(err) {</pre></code></td></tr><tr><td>146</td><td><code><pre>                log.Printf("Request to delete was already processed for file <%s>",</pre></code></td></tr><tr><td>147</td><td><code><pre>                        filepath.Base(filename))</pre></code></td></tr><tr><td>148</td><td><code><pre>        } else if err != nil {</pre></code></td></tr><tr class="miss"><td>149</td><td><code><pre>                log.Printf("Couldn't delete file <%s> : %v", filename, err)</pre></code></td></tr><tr><td>150</td><td><code><pre>        }</pre></code></td></tr><tr><td>151</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_splitKeys">func splitKeys</div><div class="info"><a href="#s_fn_splitKeys">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/helpers.go</code>:</p></div><table class="listing">
<tr><td>36</td><td><code><pre>func splitKeys(fullKey string) (string, string, error) {</pre></code></td></tr><tr><td>37</td><td><code><pre>        if isCollectionKey(fullKey) {</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>                return "", "", errorNoKey(fullKey)</pre></code></td></tr><tr><td>39</td><td><code><pre>        }</pre></code></td></tr><tr><td>40</td><td><code><pre></pre></code></td></tr><tr><td>41</td><td><code><pre>        keys := strings.SplitN(fullKey, CollKeySep, 2)</pre></code></td></tr><tr><td>42</td><td><code><pre></pre></code></td></tr><tr><td>43</td><td><code><pre>        return keys[0], keys[1], nil</pre></code></td></tr><tr><td>44</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_expandPath">func expandPath</div><div class="info"><a href="#s_fn_expandPath">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/helpers.go</code>:</p></div><table class="listing">
<tr><td>66</td><td><code><pre>func expandPath(path string) string {</pre></code></td></tr><tr><td>67</td><td><code><pre>        absPath, err := filepath.Abs(path)</pre></code></td></tr><tr><td>68</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>                panic(err)</pre></code></td></tr><tr><td>70</td><td><code><pre>        }</pre></code></td></tr><tr><td>71</td><td><code><pre></pre></code></td></tr><tr><td>72</td><td><code><pre>        return absPath</pre></code></td></tr><tr><td>73</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Store.Close">func Store.Close</div><div class="info"><a href="#s_fn_Store.Close">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/dskvs.go</code>:</p></div><table class="listing">
<tr><td>96</td><td><code><pre>func (s *Store) Close() error {</pre></code></td></tr><tr><td>97</td><td><code><pre>        if !s.isLoaded {</pre></code></td></tr><tr class="miss"><td>98</td><td><code><pre>                return errorStoreNotLoaded(s)</pre></code></td></tr><tr><td>99</td><td><code><pre>        }</pre></code></td></tr><tr><td>100</td><td><code><pre></pre></code></td></tr><tr><td>101</td><td><code><pre>        s.isLoaded = false</pre></code></td></tr><tr><td>102</td><td><code><pre></pre></code></td></tr><tr><td>103</td><td><code><pre>        storeExistsLock.Lock()</pre></code></td></tr><tr><td>104</td><td><code><pre>        delete(storeExists, s.storagePath)</pre></code></td></tr><tr><td>105</td><td><code><pre>        storeExistsLock.Unlock()</pre></code></td></tr><tr><td>106</td><td><code><pre></pre></code></td></tr><tr><td>107</td><td><code><pre>        err := jan.unloadStore(s)</pre></code></td></tr><tr><td>108</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>109</td><td><code><pre>                jan.die()</pre></code></td></tr><tr class="miss"><td>110</td><td><code><pre>                return err</pre></code></td></tr><tr><td>111</td><td><code><pre>        }</pre></code></td></tr><tr><td>112</td><td><code><pre></pre></code></td></tr><tr><td>113</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>114</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_janitor.shouldDie">func janitor.shouldDie</div><div class="info"><a href="#s_fn_janitor.shouldDie">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/janitor.go</code>:</p></div><table class="listing">
<tr><td>106</td><td><code><pre>func (j *janitor) shouldDie() chan bool {</pre></code></td></tr><tr><td>107</td><td><code><pre>        createBacklog := len(j.ToCreate)</pre></code></td></tr><tr><td>108</td><td><code><pre>        deleteBacklog := len(j.ToDelete)</pre></code></td></tr><tr><td>109</td><td><code><pre>        pageBacklog := len(j.DirtyPages)</pre></code></td></tr><tr><td>110</td><td><code><pre></pre></code></td></tr><tr><td>111</td><td><code><pre>        if createBacklog != 0 ||</pre></code></td></tr><tr><td>112</td><td><code><pre>                deleteBacklog != 0 ||</pre></code></td></tr><tr><td>113</td><td><code><pre>                pageBacklog != 0 {</pre></code></td></tr><tr class="miss"><td>114</td><td><code><pre>                log.Printf("Janitor has backlog of length %d",</pre></code></td></tr><tr><td>115</td><td><code><pre>                        createBacklog+deleteBacklog+pageBacklog)</pre></code></td></tr><tr class="miss"><td>116</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>117</td><td><code><pre>        }</pre></code></td></tr><tr><td>118</td><td><code><pre>        return j.mustDie</pre></code></td></tr><tr><td>119</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_headerFromBytes">func headerFromBytes</div><div class="info"><a href="#s_fn_headerFromBytes">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/files.go</code>:</p></div><table class="listing">
<tr><td>172</td><td><code><pre>func headerFromBytes(data []byte) (*fileHeader, error) {</pre></code></td></tr><tr><td>173</td><td><code><pre>        var header fileHeader</pre></code></td></tr><tr><td>174</td><td><code><pre>        r := bytes.NewBuffer(data)</pre></code></td></tr><tr><td>175</td><td><code><pre>        err := binary.Read(r, binary.BigEndian, &header)</pre></code></td></tr><tr><td>176</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>177</td><td><code><pre>                log.Printf("Error reading header from bytes : %v", err)</pre></code></td></tr><tr class="miss"><td>178</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>179</td><td><code><pre>        }</pre></code></td></tr><tr><td>180</td><td><code><pre>        return &header, err</pre></code></td></tr><tr><td>181</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_readFromFile">func readFromFile</div><div class="info"><a href="#s_fn_readFromFile">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/files.go</code>:</p></div><table class="listing">
<tr><td>98</td><td><code><pre>func readFromFile(filename string) (*page, error) {</pre></code></td></tr><tr><td>99</td><td><code><pre>        data, err := ioutil.ReadFile(filename)</pre></code></td></tr><tr><td>100</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>                log.Printf("Error reading file <%s> : %v", filename, err)</pre></code></td></tr><tr class="miss"><td>102</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>103</td><td><code><pre>        }</pre></code></td></tr><tr><td>104</td><td><code><pre></pre></code></td></tr><tr><td>105</td><td><code><pre>        header, err := headerFromBytes(data)</pre></code></td></tr><tr><td>106</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>107</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>108</td><td><code><pre>        }</pre></code></td></tr><tr><td>109</td><td><code><pre>        keyIndex := uint64(fileHeaderSize)</pre></code></td></tr><tr><td>110</td><td><code><pre>        payloadIndex := keyIndex + header.KeyNameLength</pre></code></td></tr><tr><td>111</td><td><code><pre>        key := string(data[keyIndex:payloadIndex])</pre></code></td></tr><tr><td>112</td><td><code><pre>        payload := data[payloadIndex:]</pre></code></td></tr><tr><td>113</td><td><code><pre></pre></code></td></tr><tr><td>114</td><td><code><pre>        hash := sha1.New().Sum(payload)</pre></code></td></tr><tr><td>115</td><td><code><pre></pre></code></td></tr><tr><td>116</td><td><code><pre>        checksum, size := binary.Uvarint(hash)</pre></code></td></tr><tr><td>117</td><td><code><pre>        if size == 0 {</pre></code></td></tr><tr class="miss"><td>118</td><td><code><pre>                log.Fatalf("Error reading file <%s> checksum, incomplete hash.",</pre></code></td></tr><tr><td>119</td><td><code><pre>                        filename)</pre></code></td></tr><tr><td>120</td><td><code><pre>        } else if size < 0 {</pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>                log.Fatal("Read too many bytes for checksum.")</pre></code></td></tr><tr><td>122</td><td><code><pre>        } else if checksum != header.Checksum {</pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>                log.Printf("Payload checksum failed for file <%s>. Header says <%v> bu checksum was <%v>",</pre></code></td></tr><tr><td>124</td><td><code><pre>                        filename,</pre></code></td></tr><tr><td>125</td><td><code><pre>                        header,</pre></code></td></tr><tr><td>126</td><td><code><pre>                        checksum)</pre></code></td></tr><tr class="miss"><td>127</td><td><code><pre>                return nil, FailedChecksumError</pre></code></td></tr><tr><td>128</td><td><code><pre>        }</pre></code></td></tr><tr><td>129</td><td><code><pre></pre></code></td></tr><tr><td>130</td><td><code><pre>        basepath := filepath.Base(filepath.Dir(filepath.Dir(filename)))</pre></code></td></tr><tr><td>131</td><td><code><pre>        coll := filepath.Base(filepath.Dir(filename))</pre></code></td></tr><tr><td>132</td><td><code><pre></pre></code></td></tr><tr><td>133</td><td><code><pre>        return &page{</pre></code></td></tr><tr><td>134</td><td><code><pre>                isDirty:   false,</pre></code></td></tr><tr><td>135</td><td><code><pre>                isDeleted: false,</pre></code></td></tr><tr><td>136</td><td><code><pre>                basepath:  basepath,</pre></code></td></tr><tr><td>137</td><td><code><pre>                coll:      coll,</pre></code></td></tr><tr><td>138</td><td><code><pre>                key:       key,</pre></code></td></tr><tr><td>139</td><td><code><pre>                value:     payload,</pre></code></td></tr><tr><td>140</td><td><code><pre>        }, nil</pre></code></td></tr><tr><td>141</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newFileHeader">func newFileHeader</div><div class="info"><a href="#s_fn_newFileHeader">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/files.go</code>:</p></div><table class="listing">
<tr><td>37</td><td><code><pre>func newFileHeader(aPage *page) *fileHeader {</pre></code></td></tr><tr><td>38</td><td><code><pre>        hash := sha1.New().Sum(aPage.value)</pre></code></td></tr><tr><td>39</td><td><code><pre>        checksum, size := binary.Uvarint(hash)</pre></code></td></tr><tr><td>40</td><td><code><pre></pre></code></td></tr><tr><td>41</td><td><code><pre>        if size == 0 {</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>                log.Fatalf("Hash too small to produce uint64: %s", hash)</pre></code></td></tr><tr><td>43</td><td><code><pre>        } else if size < 0 {</pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>                log.Printf("Hash to uint64 resulted in overflow. hash=%s, uint64=%d, overflow size=%d",</pre></code></td></tr><tr><td>45</td><td><code><pre>                        hash,</pre></code></td></tr><tr><td>46</td><td><code><pre>                        checksum,</pre></code></td></tr><tr><td>47</td><td><code><pre>                        size)</pre></code></td></tr><tr><td>48</td><td><code><pre>        }</pre></code></td></tr><tr><td>49</td><td><code><pre></pre></code></td></tr><tr><td>50</td><td><code><pre>        return &fileHeader{</pre></code></td></tr><tr><td>51</td><td><code><pre>                MAJOR_VERSION,</pre></code></td></tr><tr><td>52</td><td><code><pre>                MINOR_VERSION,</pre></code></td></tr><tr><td>53</td><td><code><pre>                PATCH_VERSION,</pre></code></td></tr><tr><td>54</td><td><code><pre>                checksum,</pre></code></td></tr><tr><td>55</td><td><code><pre>                uint64(len([]byte(aPage.key))),</pre></code></td></tr><tr><td>56</td><td><code><pre>                uint64(len(aPage.value)),</pre></code></td></tr><tr><td>57</td><td><code><pre>        }</pre></code></td></tr><tr><td>58</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_headerToBytes">func headerToBytes</div><div class="info"><a href="#s_fn_headerToBytes">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/files.go</code>:</p></div><table class="listing">
<tr><td>183</td><td><code><pre>func headerToBytes(header *fileHeader) ([]byte, error) {</pre></code></td></tr><tr><td>184</td><td><code><pre>        w := new(bytes.Buffer)</pre></code></td></tr><tr><td>185</td><td><code><pre>        err := binary.Write(w, binary.BigEndian, header)</pre></code></td></tr><tr><td>186</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>187</td><td><code><pre>                log.Printf("Error writing header to bytes : %v", err)</pre></code></td></tr><tr class="miss"><td>188</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>189</td><td><code><pre>        }</pre></code></td></tr><tr><td>190</td><td><code><pre>        return w.Bytes(), nil</pre></code></td></tr><tr><td>191</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_createFolder">func createFolder</div><div class="info"><a href="#s_fn_createFolder">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/files.go</code>:</p></div><table class="listing">
<tr><td>153</td><td><code><pre>func createFolder(create *member) {</pre></code></td></tr><tr><td>154</td><td><code><pre>        folderName := filepath.Join(create.basepath, create.coll)</pre></code></td></tr><tr><td>155</td><td><code><pre>        if err := os.MkdirAll(folderName, DIR_PERM); err != nil {</pre></code></td></tr><tr class="miss"><td>156</td><td><code><pre>                log.Printf("Couldn't create directory <%s> : %v", folderName, err)</pre></code></td></tr><tr><td>157</td><td><code><pre>        }</pre></code></td></tr><tr><td>158</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_deleteFolder">func deleteFolder</div><div class="info"><a href="#s_fn_deleteFolder">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/files.go</code>:</p></div><table class="listing">
<tr><td>160</td><td><code><pre>func deleteFolder(delete *member) {</pre></code></td></tr><tr><td>161</td><td><code><pre>        folderName := filepath.Join(delete.basepath, delete.coll)</pre></code></td></tr><tr><td>162</td><td><code><pre>        if err := os.RemoveAll(folderName); err != nil {</pre></code></td></tr><tr class="miss"><td>163</td><td><code><pre>                log.Printf("Couldn't delete folder and children at <%s> : %v",</pre></code></td></tr><tr><td>164</td><td><code><pre>                        folderName, err)</pre></code></td></tr><tr><td>165</td><td><code><pre>        }</pre></code></td></tr><tr><td>166</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_isValidPath">func isValidPath</div><div class="info"><a href="#s_fn_isValidPath">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/helpers.go</code>:</p></div><table class="listing">
<tr><td>46</td><td><code><pre>func isValidPath(path string) bool {</pre></code></td></tr><tr><td>47</td><td><code><pre>        absPath, err := filepath.Abs(path)</pre></code></td></tr><tr><td>48</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>                log.Printf("Could not get absolute filepath %v", err)</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>                return false</pre></code></td></tr><tr><td>51</td><td><code><pre>        }</pre></code></td></tr><tr><td>52</td><td><code><pre></pre></code></td></tr><tr><td>53</td><td><code><pre>        stat, err := os.Stat(absPath)</pre></code></td></tr><tr><td>54</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr><td>55</td><td><code><pre>                if os.IsNotExist(err) {</pre></code></td></tr><tr><td>56</td><td><code><pre>                        return true</pre></code></td></tr><tr><td>57</td><td><code><pre>                } else {</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>                        log.Printf("Could not get stat %v", err)</pre></code></td></tr><tr class="miss"><td>59</td><td><code><pre>                        return false</pre></code></td></tr><tr><td>60</td><td><code><pre>                }</pre></code></td></tr><tr><td>61</td><td><code><pre>        }</pre></code></td></tr><tr><td>62</td><td><code><pre></pre></code></td></tr><tr><td>63</td><td><code><pre>        return stat.IsDir()</pre></code></td></tr><tr><td>64</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Store.Delete">func Store.Delete</div><div class="info"><a href="#s_fn_Store.Delete">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/dskvs.go</code>:</p></div><table class="listing">
<tr><td>192</td><td><code><pre>func (s *Store) Delete(fullKey string) error {</pre></code></td></tr><tr><td>193</td><td><code><pre>        if !s.isLoaded {</pre></code></td></tr><tr class="miss"><td>194</td><td><code><pre>                return errorStoreNotLoaded(s)</pre></code></td></tr><tr><td>195</td><td><code><pre>        }</pre></code></td></tr><tr><td>196</td><td><code><pre></pre></code></td></tr><tr><td>197</td><td><code><pre>        if err := checkKeyValid(fullKey); err != nil {</pre></code></td></tr><tr class="miss"><td>198</td><td><code><pre>                return err</pre></code></td></tr><tr><td>199</td><td><code><pre>        }</pre></code></td></tr><tr><td>200</td><td><code><pre></pre></code></td></tr><tr><td>201</td><td><code><pre>        if isCollectionKey(fullKey) {</pre></code></td></tr><tr class="miss"><td>202</td><td><code><pre>                return errorDeleteIsColl(fullKey)</pre></code></td></tr><tr><td>203</td><td><code><pre>        }</pre></code></td></tr><tr><td>204</td><td><code><pre></pre></code></td></tr><tr><td>205</td><td><code><pre>        coll, key, err := splitKeys(fullKey)</pre></code></td></tr><tr><td>206</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>207</td><td><code><pre>                return err</pre></code></td></tr><tr><td>208</td><td><code><pre>        }</pre></code></td></tr><tr><td>209</td><td><code><pre></pre></code></td></tr><tr><td>210</td><td><code><pre>        return s.coll.deleteKey(coll, key)</pre></code></td></tr><tr><td>211</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Store.Get">func Store.Get</div><div class="info"><a href="#s_fn_Store.Get">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/dskvs.go</code>:</p></div><table class="listing">
<tr><td>128</td><td><code><pre>func (s *Store) Get(fullKey string) ([]byte, error) {</pre></code></td></tr><tr><td>129</td><td><code><pre>        if !s.isLoaded {</pre></code></td></tr><tr class="miss"><td>130</td><td><code><pre>                return nil, errorStoreNotLoaded(s)</pre></code></td></tr><tr><td>131</td><td><code><pre>        }</pre></code></td></tr><tr><td>132</td><td><code><pre></pre></code></td></tr><tr><td>133</td><td><code><pre>        if err := checkKeyValid(fullKey); err != nil {</pre></code></td></tr><tr class="miss"><td>134</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>135</td><td><code><pre>        }</pre></code></td></tr><tr><td>136</td><td><code><pre></pre></code></td></tr><tr><td>137</td><td><code><pre>        if isCollectionKey(fullKey) {</pre></code></td></tr><tr class="miss"><td>138</td><td><code><pre>                return nil, errorGetIsColl(fullKey)</pre></code></td></tr><tr><td>139</td><td><code><pre>        }</pre></code></td></tr><tr><td>140</td><td><code><pre></pre></code></td></tr><tr><td>141</td><td><code><pre>        coll, key, err := splitKeys(fullKey)</pre></code></td></tr><tr><td>142</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>143</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>144</td><td><code><pre>        }</pre></code></td></tr><tr><td>145</td><td><code><pre></pre></code></td></tr><tr><td>146</td><td><code><pre>        return s.coll.get(coll, key)</pre></code></td></tr><tr><td>147</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Store.Put">func Store.Put</div><div class="info"><a href="#s_fn_Store.Put">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/dskvs.go</code>:</p></div><table class="listing">
<tr><td>170</td><td><code><pre>func (s *Store) Put(fullKey string, value []byte) error {</pre></code></td></tr><tr><td>171</td><td><code><pre>        if !s.isLoaded {</pre></code></td></tr><tr class="miss"><td>172</td><td><code><pre>                return errorStoreNotLoaded(s)</pre></code></td></tr><tr><td>173</td><td><code><pre>        }</pre></code></td></tr><tr><td>174</td><td><code><pre></pre></code></td></tr><tr><td>175</td><td><code><pre>        if err := checkKeyValid(fullKey); err != nil {</pre></code></td></tr><tr class="miss"><td>176</td><td><code><pre>                return err</pre></code></td></tr><tr><td>177</td><td><code><pre>        }</pre></code></td></tr><tr><td>178</td><td><code><pre></pre></code></td></tr><tr><td>179</td><td><code><pre>        if isCollectionKey(fullKey) {</pre></code></td></tr><tr class="miss"><td>180</td><td><code><pre>                return errorPutIsColl(fullKey, string(value))</pre></code></td></tr><tr><td>181</td><td><code><pre>        }</pre></code></td></tr><tr><td>182</td><td><code><pre></pre></code></td></tr><tr><td>183</td><td><code><pre>        coll, key, err := splitKeys(fullKey)</pre></code></td></tr><tr><td>184</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>185</td><td><code><pre>                return err</pre></code></td></tr><tr><td>186</td><td><code><pre>        }</pre></code></td></tr><tr><td>187</td><td><code><pre></pre></code></td></tr><tr><td>188</td><td><code><pre>        return s.coll.put(coll, key, value)</pre></code></td></tr><tr><td>189</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_checkKeyValid">func checkKeyValid</div><div class="info"><a href="#s_fn_checkKeyValid">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/helpers.go</code>:</p></div><table class="listing">
<tr><td>12</td><td><code><pre>func checkKeyValid(key string) error {</pre></code></td></tr><tr><td>13</td><td><code><pre>        idxSeperator := strings.Index(key, CollKeySep)</pre></code></td></tr><tr><td>14</td><td><code><pre>        if idxSeperator == 0 {</pre></code></td></tr><tr class="miss"><td>15</td><td><code><pre>                return errorNoColl(key)</pre></code></td></tr><tr><td>16</td><td><code><pre>        } else if key == "" {</pre></code></td></tr><tr class="miss"><td>17</td><td><code><pre>                return errorEmptyKey()</pre></code></td></tr><tr><td>18</td><td><code><pre>        }</pre></code></td></tr><tr><td>19</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>20</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_janitor.dirtyPageIfNoMember">func janitor.dirtyPageIfNoMember</div><div class="info"><a href="#s_fn_janitor.dirtyPageIfNoMember">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/janitor.go</code>:</p></div><table class="listing">
<tr><td>96</td><td><code><pre>func (j *janitor) dirtyPageIfNoMember() chan *page {</pre></code></td></tr><tr><td>97</td><td><code><pre>        if len(j.ToCreate) != 0 {</pre></code></td></tr><tr class="miss"><td>98</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>99</td><td><code><pre>        }</pre></code></td></tr><tr><td>100</td><td><code><pre>        if len(j.ToDelete) != 0 {</pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>102</td><td><code><pre>        }</pre></code></td></tr><tr><td>103</td><td><code><pre>        return j.DirtyPages</pre></code></td></tr><tr><td>104</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Store.GetAll">func Store.GetAll</div><div class="info"><a href="#s_fn_Store.GetAll">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/dskvs.go</code>:</p></div><table class="listing">
<tr><td>150</td><td><code><pre>func (s *Store) GetAll(coll string) ([][]byte, error) {</pre></code></td></tr><tr><td>151</td><td><code><pre>        if !s.isLoaded {</pre></code></td></tr><tr class="miss"><td>152</td><td><code><pre>                return nil, errorStoreNotLoaded(s)</pre></code></td></tr><tr><td>153</td><td><code><pre>        }</pre></code></td></tr><tr><td>154</td><td><code><pre></pre></code></td></tr><tr><td>155</td><td><code><pre>        if err := checkKeyValid(coll); err != nil {</pre></code></td></tr><tr class="miss"><td>156</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>157</td><td><code><pre>        }</pre></code></td></tr><tr><td>158</td><td><code><pre></pre></code></td></tr><tr><td>159</td><td><code><pre>        if !isCollectionKey(coll) {</pre></code></td></tr><tr class="miss"><td>160</td><td><code><pre>                return nil, errorGetAllIsNotColl(coll)</pre></code></td></tr><tr><td>161</td><td><code><pre>        }</pre></code></td></tr><tr><td>162</td><td><code><pre></pre></code></td></tr><tr><td>163</td><td><code><pre>        return s.coll.getCollection(coll)</pre></code></td></tr><tr><td>164</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Store.DeleteAll">func Store.DeleteAll</div><div class="info"><a href="#s_fn_Store.DeleteAll">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/dskvs.go</code>:</p></div><table class="listing">
<tr><td>214</td><td><code><pre>func (s *Store) DeleteAll(coll string) error {</pre></code></td></tr><tr><td>215</td><td><code><pre>        if !s.isLoaded {</pre></code></td></tr><tr class="miss"><td>216</td><td><code><pre>                return errorStoreNotLoaded(s)</pre></code></td></tr><tr><td>217</td><td><code><pre>        }</pre></code></td></tr><tr><td>218</td><td><code><pre></pre></code></td></tr><tr><td>219</td><td><code><pre>        if err := checkKeyValid(coll); err != nil {</pre></code></td></tr><tr class="miss"><td>220</td><td><code><pre>                return err</pre></code></td></tr><tr><td>221</td><td><code><pre>        }</pre></code></td></tr><tr><td>222</td><td><code><pre></pre></code></td></tr><tr><td>223</td><td><code><pre>        if !isCollectionKey(coll) {</pre></code></td></tr><tr class="miss"><td>224</td><td><code><pre>                return errorDeleteAllIsNotColl(coll)</pre></code></td></tr><tr><td>225</td><td><code><pre>        }</pre></code></td></tr><tr><td>226</td><td><code><pre></pre></code></td></tr><tr><td>227</td><td><code><pre>        return s.coll.deleteCollection(coll)</pre></code></td></tr><tr><td>228</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_KeyError.Error">func KeyError.Error</div><div class="info"><a href="#s_fn_KeyError.Error">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>64</td><td><code><pre>func (e KeyError) Error() string {</pre></code></td></tr><tr class="miss"><td>65</td><td><code><pre>        return fmt.Sprintf("%v: %v", e.When, e.What)</pre></code></td></tr><tr><td>66</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorGetAllIsNotColl">func errorGetAllIsNotColl</div><div class="info"><a href="#s_fn_errorGetAllIsNotColl">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>119</td><td><code><pre>func errorGetAllIsNotColl(key string) error {</pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>        return KeyError{</pre></code></td></tr><tr><td>121</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>122</td><td><code><pre>                fmt.Sprintf("key <%s> requested a GetAll for only a member",</pre></code></td></tr><tr><td>123</td><td><code><pre>                        key),</pre></code></td></tr><tr><td>124</td><td><code><pre>        }</pre></code></td></tr><tr><td>125</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorGetIsColl">func errorGetIsColl</div><div class="info"><a href="#s_fn_errorGetIsColl">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>111</td><td><code><pre>func errorGetIsColl(key string) error {</pre></code></td></tr><tr class="miss"><td>112</td><td><code><pre>        return KeyError{</pre></code></td></tr><tr><td>113</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>114</td><td><code><pre>                fmt.Sprintf("key <%s> requested a Get on a collection",</pre></code></td></tr><tr><td>115</td><td><code><pre>                        key),</pre></code></td></tr><tr><td>116</td><td><code><pre>        }</pre></code></td></tr><tr><td>117</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorEmptyKey">func errorEmptyKey</div><div class="info"><a href="#s_fn_errorEmptyKey">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>86</td><td><code><pre>func errorEmptyKey() error {</pre></code></td></tr><tr class="miss"><td>87</td><td><code><pre>        return KeyError{</pre></code></td></tr><tr><td>88</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>89</td><td><code><pre>                fmt.Sprintf("key is empty"),</pre></code></td></tr><tr><td>90</td><td><code><pre>        }</pre></code></td></tr><tr><td>91</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorNoKey">func errorNoKey</div><div class="info"><a href="#s_fn_errorNoKey">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>79</td><td><code><pre>func errorNoKey(key string) error {</pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>        return KeyError{</pre></code></td></tr><tr><td>81</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>82</td><td><code><pre>                fmt.Sprintf("key<%s> has no member identifier", key),</pre></code></td></tr><tr><td>83</td><td><code><pre>        }</pre></code></td></tr><tr><td>84</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorNoColl">func errorNoColl</div><div class="info"><a href="#s_fn_errorNoColl">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>72</td><td><code><pre>func errorNoColl(key string) error {</pre></code></td></tr><tr class="miss"><td>73</td><td><code><pre>        return KeyError{</pre></code></td></tr><tr><td>74</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>75</td><td><code><pre>                fmt.Sprintf("key<%s> has no collection identifier", key),</pre></code></td></tr><tr><td>76</td><td><code><pre>        }</pre></code></td></tr><tr><td>77</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorPathInvalid">func errorPathInvalid</div><div class="info"><a href="#s_fn_errorPathInvalid">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>49</td><td><code><pre>func errorPathInvalid(path string) error {</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        return PathError{</pre></code></td></tr><tr><td>51</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>52</td><td><code><pre>                fmt.Sprintf("String <%s> is not a valid path", path),</pre></code></td></tr><tr><td>53</td><td><code><pre>        }</pre></code></td></tr><tr><td>54</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorPathInUse">func errorPathInUse</div><div class="info"><a href="#s_fn_errorPathInUse">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>42</td><td><code><pre>func errorPathInUse(path string) error {</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>        return PathError{</pre></code></td></tr><tr><td>44</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>45</td><td><code><pre>                fmt.Sprintf("Path <%s> is already used by another Store", path),</pre></code></td></tr><tr><td>46</td><td><code><pre>        }</pre></code></td></tr><tr><td>47</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_PathError.Error">func PathError.Error</div><div class="info"><a href="#s_fn_PathError.Error">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>38</td><td><code><pre>func (e PathError) Error() string {</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>        return fmt.Sprintf("%v: %v", e.When, e.What)</pre></code></td></tr><tr><td>40</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorStoreNotLoaded">func errorStoreNotLoaded</div><div class="info"><a href="#s_fn_errorStoreNotLoaded">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>19</td><td><code><pre>func errorStoreNotLoaded(s *Store) error {</pre></code></td></tr><tr class="miss"><td>20</td><td><code><pre>        return StoreError{</pre></code></td></tr><tr><td>21</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>22</td><td><code><pre></pre></code></td></tr><tr><td>23</td><td><code><pre>                fmt.Sprintf("Store with path <%s> has not yet been loaded",</pre></code></td></tr><tr><td>24</td><td><code><pre>                        s.storagePath),</pre></code></td></tr><tr><td>25</td><td><code><pre>        }</pre></code></td></tr><tr><td>26</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_StoreError.Error">func StoreError.Error</div><div class="info"><a href="#s_fn_StoreError.Error">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>15</td><td><code><pre>func (e StoreError) Error() string {</pre></code></td></tr><tr class="miss"><td>16</td><td><code><pre>        return fmt.Sprintf("%v: %v", e.When, e.What)</pre></code></td></tr><tr><td>17</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorDeleteAllIsNotColl">func errorDeleteAllIsNotColl</div><div class="info"><a href="#s_fn_errorDeleteAllIsNotColl">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>143</td><td><code><pre>func errorDeleteAllIsNotColl(key string) error {</pre></code></td></tr><tr class="miss"><td>144</td><td><code><pre>        return KeyError{</pre></code></td></tr><tr><td>145</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>146</td><td><code><pre>                fmt.Sprintf("key <%s> requested a DeleteAll for only a member",</pre></code></td></tr><tr><td>147</td><td><code><pre>                        key),</pre></code></td></tr><tr><td>148</td><td><code><pre>        }</pre></code></td></tr><tr><td>149</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorDeleteIsColl">func errorDeleteIsColl</div><div class="info"><a href="#s_fn_errorDeleteIsColl">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>135</td><td><code><pre>func errorDeleteIsColl(key string) error {</pre></code></td></tr><tr class="miss"><td>136</td><td><code><pre>        return KeyError{</pre></code></td></tr><tr><td>137</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>138</td><td><code><pre>                fmt.Sprintf("key <%s> requested a Delete on a collection",</pre></code></td></tr><tr><td>139</td><td><code><pre>                        key),</pre></code></td></tr><tr><td>140</td><td><code><pre>        }</pre></code></td></tr><tr><td>141</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_errorPutIsColl">func errorPutIsColl</div><div class="info"><a href="#s_fn_errorPutIsColl">Back</a><p>In <code>/Users/antoine/gocode/src/github.com/aybabtme/dskvs/errors.go</code>:</p></div><table class="listing">
<tr><td>127</td><td><code><pre>func errorPutIsColl(key, val string) error {</pre></code></td></tr><tr class="miss"><td>128</td><td><code><pre>        return KeyError{</pre></code></td></tr><tr><td>129</td><td><code><pre>                time.Now(),</pre></code></td></tr><tr><td>130</td><td><code><pre>                fmt.Sprintf("key,val <%s,%s> requested a Put on a collection",</pre></code></td></tr><tr><td>131</td><td><code><pre>                        key),</pre></code></td></tr><tr><td>132</td><td><code><pre>        }</pre></code></td></tr><tr><td>133</td><td><code><pre>}</pre></code></td></tr></table>
<script type="text/javascript">
document.getElementById("totalcov").textContent = "78.32%"
</script>
<!-- Can be parsed by external script
PACKAGE:github.com/aybabtme/dskvs DONE:78.32
-->

    </body>
</html>
